<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description" content="" />
  <meta name="author" content="" />
  <title>AndGui</title>
  <link rel="icon" type="image/x-icon" href="IMG/androide.png" />
  <!-- Font Awesome icons (free version)-->
  <script src="https://use.fontawesome.com/releases/v5.13.0/js/all.js" crossorigin="anonymous"></script>
  <!-- Google fonts-->
  <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:500,700" rel="stylesheet" type="text/css" />
  <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,800,800i" rel="stylesheet" type="text/css" />
  <!-- Core theme CSS (includes Bootstrap)-->
  <link href="../css/styles.css" rel="stylesheet" />
</head>

<body id="page-top">
  <!-- Navigation-->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary1 fixed-top" id="sideNav">
    <a class="navbar-brand js-scroll-trigger" href="#page-top">
      <span class="d-block d-lg-none">Services & Thread</span>
      <span class="d-none d-lg-block"><a class="kkk" href="../index.html"> <img class="img-fluid img-profile rounded-circle mx-auto mb-2" src="../IMG/home.png" alt="" />  </a></span>

    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span
        class="navbar-toggler-icon"></span></button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link js-scroll-trigger" href="and_configuracion.html">Configuracion </a></li>
        <li class="nav-item"><a class="nav-link js-scroll-trigger" href="and_Git-Github.html">Git-GitHub</a></li>
        <li class="nav-item"><a class="nav-link js-scroll-trigger" href="and_logicas.html">Logicas</a></li>
        <li class="nav-item"><a class="nav-link js-scroll-trigger" href="and_fragments.html">Fragments</a></li>
        <li class="nav-item"><a class="nav-link js-scroll-trigger" href="and_sqlite.html">SQLite</a></li>
        <li class="nav-item"><a class="nav-link js-scroll-trigger" href="and_mapLocation.html">Map-Location</a></li>
        <li class="nav-item"><a class="nav-link js-scroll-trigger" href="and_arquitectura.html">Arquitectura <span
              class="sr-only">(current)</span></a></li>
        <li class="nav-item"><a class="nav-link js-scroll-trigger" href="and_debugTest.html">Debug-test</a></li>
         <li class="nav-item"><a class="nav-link js-scroll-trigger" href="and_services.html">Services</a></li>
         <li class="nav-item"><a class="nav-link js-scroll-trigger" href="listas.html">Listas</a></li>
      </ul>
    </div>
  </nav>
  <!-- Page Content-->
  <div class="container">

    <div class="row">

      <!-- Blog Entries Column -->
      <div class="col-md-8">

        <h2 class="my-4">Services & Thread

        </h2>
        <!--
        ////////////////////////////////////////////
        /////////////////////////////////////////
        ////////////////////////////////////////-->
 <!-- Blog Post -->
 <div class="card mb-4">

  <div class="card-body">
    <h3 class="card-title">Services<br></h3>

    <p class="card-text">Un <i>Service</i> es un componente de una aplicación que puede 
      realizar operaciones de larga ejecución en segundo plano y que no proporciona una interfaz de usuario.<br>
      Para crear un servicio se debe generar una subclase Service: <b> extends Service</b>. <br>
      Adicionalmente, todos los servicios deben ser declarados en el Manifest, colocando una 
      etiqueta <b>**service**</b>, con los atributos: name, enable y exported (El atributo name, es el unico obligatorio)<br>
      Puedes garantizar que tu servicio esté disponible solo para tu aplicación incluyendo el atributo android:exported 
      y configurándolo en false. Esto impide que otras aplicaciones inicien tu servicio, incluso cuando se utiliza una
       intent explícita.<br>

    </p>
    <p></p>
    <img class="card-img-top" src="IMG/SERVICES/sv7 .png" alt="Card image cap">
    <p class="card-text"></p>

    <p class="card-text"> Para Iniciar el servicio desde otro activity se debe invocar el metodo <b>startService()</b>
      Colocando como parametro un <b>intent</b> que apunte a la clase del servicio<br>
      tambien se puede declarar como:<br>
      <b><i>starService(new Intent(this, NOMBRECLASE_SERVICIO.class))</i></b>
      <br>    
    </p>

    <img class="card-img-top" src="IMG/SERVICES/ss1.png" alt="Card image cap">
    <p class="card-text"></p>

    

    <p class="card-text">El servicio arranca con el metodo <b>onStartCommand(Intent intent, int flags, int startId)</b>.<br>
      por lo cual las funciones a ejecutar se deben incluir en este.
    </p>

    <img class="card-img-top" src="IMG/SERVICES/ss2.png" alt="Card image cap">
    <p class="card-text"></p>
   

  </div>


  
 

  


  <div class="card-footer text-muted">
    Publicado en febrero 9, 2020 by
    <a href="https://github.com/armandopinzonvera">Armando Pinzon</a>
  </div>
</div>
<!-- 
     *********************************************************
     *********************************************************
     *********************************************************
 -->


        
        <!-- Blog Post -->
        <div class="card mb-4">

          <div class="card-body">
            <h3 class="card-title">Services Location<br></h3>

            <p class="card-text">
              No se debe olvidar que los servicios se deben declarar en el <b>manifest</b>, además que tratándose de
              <i>location</i>, se debe indicar en ese mismo archivo, los permiso de acceso a fine location y agregar la
              implementación del <b>API-SERVICE</b> que se puede ver en el apartado de <a target="blank"
                href="mapLocation.html">Map-Location</a>

            </p>
            <p class="card-text"> Esta es la clase con el servicio<br>

              <pre class="pre-scrollable"> 
                <code class="text-dark">
 public class Service_Location extends Service {

         static final int LOCATION_SERVICE_ID = 175;
         static final String ACTION_START_LOCATION_SERVICE = "Iniciar Servicio de localizacion";
         static final String ACTION_STOP_LOCATION_SERVICE = "Finalizar servicio de localizacion";
                    
        private LocationCallback locationCallback = new LocationCallback() {
                    
            @Override
             public void onLocationResult(LocationResult locationResult) {
                 super.onLocationResult(locationResult);
                 if (locationResult != null && locationResult.getLastLocation() != null) {
                     double latitude = locationResult.getLastLocation().getLatitude();
                     double longitude = locationResult.getLastLocation().getLongitude();
                    
                     MainActivity.putValue(latitude);
                     Log.d("LOCATION UPDATE", latitude + ", "+longitude);
                }
             }
        };
                    
         @Nullable
         @Override
         public IBinder onBind(Intent intent) {
            throw new UnsupportedOperationException("Aun no esta implementado");
         }
                    
        private void startLocationService(){
             String channelId= "Notificacion de canal de Localizacion";
              NotificationManager notificationManager =
                     (NotificationManager)getSystemService(Context.NOTIFICATION_SERVICE);
             Intent resultIntent = new Intent();
             PendingIntent pendingIntent = PendingIntent.getActivity(
                     getApplicationContext(),
                    0,
                     resultIntent,
                     PendingIntent.FLAG_UPDATE_CURRENT);
             NotificationCompat.Builder builder = new NotificationCompat.Builder(
                     getApplicationContext(),
                     channelId
             );
             builder.setSmallIcon(R.mipmap.ic_launcher);
             builder.setContentTitle("Servicio de Localizacion");
             builder.setDefaults(NotificationCompat.DEFAULT_ALL);
             builder.setContentText("Corriendo");
             builder.setContentIntent(pendingIntent);
            builder.setAutoCancel(false);
            builder.setPriority(NotificationCompat.PRIORITY_MAX);
                    
             if(Build.VERSION.SDK_INT >= Build.VERSION_CODES.O){
                  if(notificationManager != null
                 && notificationManager.getNotificationChannel(channelId) == null){
                   NotificationChannel notificationChannel = new NotificationChannel(
                           channelId,
                          "Location Service",
         NotificationManager.IMPORTANCE_HIGH
                   );
                  notificationChannel.setDescription("Este canal es usado para el servicio de localizacion");
                  notificationManager.createNotificationChannel(notificationChannel);
              }
            }
                    
           @SuppressLint("RestrictedApi")
           LocationRequest locationRequest = new LocationRequest();
           locationRequest.setInterval(4000);
           locationRequest.setFastestInterval(2000);
          locationRequest.setPriority(LocationRequest.PRIORITY_HIGH_ACCURACY);
                    
          LocationServices.getFusedLocationProviderClient(this)
                  .requestLocationUpdates(locationRequest, locationCallback, Looper.getMainLooper());
           startForeground(LOCATION_SERVICE_ID, builder.build());
      }
      private void stopLocationService(){
          LocationServices.getFusedLocationProviderClient(this).removeLocationUpdates(locationCallback);
          stopForeground(true);
          stopSelf();
      }
                    
      @Override
      public int onStartCommand(Intent intent, int flags, int startId) {
           if(intent != null){
               String action = intent.getAction();
               if(action != null){
                  if(action.equals(ACTION_START_LOCATION_SERVICE)){
                      startLocationService();
                   }else if(action.equals(ACTION_STOP_LOCATION_SERVICE)){
                       stopLocationService();
                  }
              }
           }
                    
           return super.onStartCommand(intent, flags, startId);
      }
  }</code> </pre>

            </p>

            <img class="card-img-top" src="IMG/SERVICES/sv1.png" alt="Card image cap">
            <p class="card-text"></p>

            <img class="card-img-top" src="IMG/SERVICES/sv2.png" alt="Card image cap">
            <p class="card-text"></p>

            <img class="card-img-top" src="IMG/SERVICES/sv3.png" alt="Card image cap">
            <p class="card-text"></p>

            <p class="card-text"> Este es el Main Activity que recibe, ademas arranca los permisos<br>
              <pre class="pre-scrollable"> 
                <code class="text-dark"> public class MainActivity extends AppCompatActivity {

                        private static final int REQUEST_CODE_LOCATION_PERMISSION = 1;
                        static TextView tvlat;
                    
                        @Override
                        protected void onCreate(Bundle savedInstanceState) {
                            super.onCreate(savedInstanceState);
                            setContentView(R.layout.activity_main);
                            tvlat=findViewById(R.id.tv_lat);
                    
                            findViewById(R.id.btt_startLocation).setOnClickListener(new View.OnClickListener() {
                                @Override
                                public void onClick(View v) {
                                    if(ContextCompat.checkSelfPermission(
                                            getApplicationContext(), Manifest.permission.ACCESS_FINE_LOCATION
                                    )!= PackageManager.PERMISSION_GRANTED){
                                        ActivityCompat.requestPermissions(
                                                MainActivity.this,
                                                new String[]{Manifest.permission.ACCESS_FINE_LOCATION},
                                                REQUEST_CODE_LOCATION_PERMISSION
                                        );
                                    }else{
                                        startLocationService();
                                    }
                                }
                            });
                            findViewById(R.id.btt_stopLocation).setOnClickListener(new View.OnClickListener() {
                                @Override
                                public void onClick(View v) {
                                    stopLocationService();
                                }
                            });
                    
                        }
                    
                        @Override
                        public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {
                            super.onRequestPermissionsResult(requestCode, permissions, grantResults);
                            if(requestCode == REQUEST_CODE_LOCATION_PERMISSION && grantResults.length > 0){
                                if(grantResults[0] == PackageManager.PERMISSION_GRANTED){
                                    startLocationService();
                                }else{
                                    Toast.makeText(this, "**Permiso negado**", Toast.LENGTH_LONG).show();
                                }
                            }
                        }
                    
                        private boolean isLocationServiceRunning(){
                            ActivityManager activityManager = (ActivityManager) getSystemService(Context.ACTIVITY_SERVICE);
                            if(activityManager != null){
                                for(ActivityManager.RunningServiceInfo service:
                                activityManager.getRunningServices(Integer.MAX_VALUE)){
                                    if(LocationServices.class.getName().equals(service.service.getClassName())){
                                        if(service.foreground){
                                            return true;
                                        }
                                    }
                                }
                                return false;
                            }
                            return false;
                        }
                    
                        private void startLocationService(){
                            Intent intent = new Intent(getApplicationContext(), Service_Location.class);
                            intent.setAction(Service_Location.ACTION_START_LOCATION_SERVICE);
                            startService(intent);
                            Toast.makeText(this, "Servicio de Localizacion iniciado",Toast.LENGTH_LONG).show();
                            /*if(isLocationServiceRunning()){
                                Intent intent = new Intent(getApplicationContext(), Service_Location.class);
                                intent.setAction(Service_Location.ACTION_START_LOCATION_SERVICE);
                                startService(intent);
                                Toast.makeText(this, "Servicio de Localizacion iniciado",Toast.LENGTH_LONG).show();
                            }*/
                        }
                        private void stopLocationService(){
                            Intent intent = new Intent(getApplicationContext(), Service_Location.class);
                            intent.setAction(Service_Location.ACTION_STOP_LOCATION_SERVICE);
                            startService(intent);
                            Toast.makeText(this, "Servicio de Localizacion detenido",Toast.LENGTH_LONG).show();
                           /* if(isLocationServiceRunning()){
                                Intent intent = new Intent(getApplicationContext(), Service_Location.class);
                                intent.setAction(Service_Location.ACTION_STOP_LOCATION_SERVICE);
                                startService(intent);
                                Toast.makeText(this, "Servicio de Localizacion detenido",Toast.LENGTH_LONG).show();
                            }*/
                        }
                        public static void putValue(double latit){
                            tvlat.setText(String.valueOf(latit));
                        }
                    
                    }
                      
                           }</code></pre>
            </p>

            <img class="card-img-top" src="IMG/SERVICES/sv4.png" alt="Card image cap">
            <p class="card-text"></p>
            <img class="card-img-top" src="IMG/SERVICES/sv5.png" alt="Card image cap">
            <p class="card-text"></p>
            <img class="card-img-top" src="IMG/SERVICES/sv6.png" alt="Card image cap">
            <p class="card-text"></p>

          </div>


          <p class="card-text"> Declaracion del servicio en el manifest<br>
            <pre class="pre">
                      service
                      android:name=".Service_Location"
                      android:enabled="true"
                     android:exported="false"
                    </pre>
          </p>

          <img class="card-img-top" src="IMG/SERVICES/sv7 .png" alt="Card image cap">


          <div class="card-footer text-muted">
            Publicado en Agosto 24, 2020 by
            <a href="https://github.com/armandopinzonvera">Armando Pinzon</a>
          </div>
        </div>
        <!-- 
             *********************************************************
             *********************************************************
             *********************************************************
         -->
        <!-- Blog Post -->
        <div class="card mb-4">

          <div class="card-body">
            <h3 class="card-title">Thread</h3>
            <p class="card-text">El hilo (Thread) nos permite correr un método en segundo plano, emplea una variable
              <i>Boolean</i> inicializada como <b>false</b>, que al ser llamada por el método pasa a ser <b>true</b>,
              que en este caso se llama <i>arrancar_hilo</i>.<br>
              El hilo se crea con la línea <b>new Thread(new Runnable)</b> a lo cual Android estudio despliega el resto
              del método de manera automática. Al final se le coloca <b>.start() </b>, para arrancarlo<br>
              Presenta un bucle <b>while</b> con el cual se mantiene la acción andando y se indica la velocidad de
              ejecución con <b>Threas.sleep(5000)</b>; el método sleep genera error, a lo cual Android studio nos ofrece
              envolverlo con un <b>try-catch</b>.<br>
              Para que se pueda colocar el envio de un texto a la interfaz gráfica desde el hilo, ya sea por Toast o
              utilizando los wigets, se debe colocar el método <b>runOnUiThread(new Runnble()..)</b> a lo cual de manera
              automática Android estudio nos despliega el método <b>run</b> y dentro de este colocamos el envió a la
              interfaz.
            </p>
            <p></p>
            <pre class="pre">
                         private Boolean arrancar_hilo = false;
                          public void hilo(){
                              if (!arrancar_hilo){
                              arrancar_hilo = true;
                              new Thread(new Runnable() {
                                  @Override
                                  public void run() {
                                      while(arrancar_hilo){
                                          runOnUiThread(new Runnable() {
                                              @Override
                                              public void run() {
                                                  Toast.makeText(VistaTransecto.this, "HILO", Toast.LENGTH_SHORT).show();
                                              }
                                          });
                                          try {
                                              Thread.sleep(5000);
                                          } catch (InterruptedException e) {
                                              e.printStackTrace();
                                          }
                                      }
                                  }
                              }).start();
                              }
                          }        </pre>


            <img class="card-img-top" src="IMG/SERVICES/tr1.png" alt="Card image cap">
            <p></p>


            <p></p>

          </div>


          <div class="card-footer text-muted">
            Posted on septiembre 9, 2020 by
            <a href="https://github.com/armandopinzonvera">Armando Pinzon</a>
          </div>
        </div>

        <!-- Pagination -->
        <ul class="pagination justify-content-center mb-4">
          <li class="page-item">
            <a class="page-link" href="index.html">&larr; Anterior</a>
          </li>
          <li class="page-item">
            <a class="page-link" href="logicas.html">Siguiente &rarr;</a>
          </li>
        </ul>

      </div>

      <!-- Sidebar Widgets Column -->
      <div class="col-md-4">

        <!-- Search Widget -->
        <div class="card my-4">
          <h5 class="card-header">Buscar</h5>
          <div class="card-body">
            <div class="input-group">
              <input type="search" class="form-control" placeholder="En Android Developers...">
              <span class="input-group-append">
                <button class="btn btn-secondary" type="button">Ir!</button>
              </span>
            </div>
          </div>
        </div>

        <!-- Categories Widget -->
        <div class="card my-4">
          <h5 class="card-header">Temas</h5>
          <div class="card-body">
            <div class="row">
              <div class="col-lg-6">
                <ul class="list-unstyled mb-0">
                  <li>
                    <a href="#">Service</a>
                  </li>
                  <li>
                    <a href="#">Service Location</a>
                  </li>
                  <li>
                    <a href="#">Thread</a>
                  </li>
                </ul>
              </div>
              <div class="col-lg-6">
                <ul class="list-unstyled mb-0">
                  <li>
                    <a href="#">-</a>
                  </li>
                  <li>
                    <a href="#">-</a>
                  </li>

                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- Side Widget -->
        <div class="card my-4">
          <h5 class="card-header">Guia Android Studio</h5>
          <div class="card-body">
            Este Blog buscar ser un complemento a los tutoriales de Android Studio para colocar a disposición guías
            fotográficas de los procedimientos más comunes, con los cuales se pueda construir aplicaciones completas
            para subir en el Android Store.
          </div>
        </div>

      </div>

    </div>
    <!-- /.row -->

  </div>
  <!-- /.container -->

  <!-- Footer -->
  <footer class="py-5 bg-dark">
    <div class="container">
      <p class="m-0 text-center text-white">Copyright &copy; www.armandopinzonv.tk</p>
    </div>
    <!-- /.container -->
  </footer>

  <!-- Bootstrap core JS-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js"></script>
  <!-- Third party plugin JS-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
  <!-- Core theme JS-->
  <script src="../js/scripts.js"></script>
</body>

</html>